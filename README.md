# Tasks Manager

Веб-приложение для управления задачами с поддержкой создания, редактирования, удаления и фильтрации задач. Реализовано на React с использованием архитектуры Feature-Sliced Design.

## Описание проекта

Tasks Manager — это полнофункциональное приложение для управления задачами, которое позволяет:

- Просматривать список задач с пагинацией
- Создавать новые задачи с указанием категории, статуса и приоритета
- Редактировать существующие задачи
- Удалять задачи с подтверждением
- Переключать темную/светлую тему
- Фильтровать задачи по категории, статусу и приоритету

Приложение состоит из двух частей:
- **Frontend** — React приложение с TypeScript
- **Backend** — JSON Server API для имитации REST API

## Запуск проекта

### Локальный запуск

#### Предварительные требования

- Node.js 18+ и npm
- Или Docker и Docker Compose

#### Вариант 1: Без Docker

1. Установите зависимости для фронтенда:
```bash
cd frontend
npm install
```

2. Установите зависимости для бэкенда:
```bash
cd ../json-server
npm install
```

3. Запустите JSON Server (в отдельном терминале):
```bash
cd json-server
npm start
```

4. Запустите фронтенд приложение (в другом терминале):
```bash
cd frontend
npm run dev
```

Приложение будет доступно по адресу `http://localhost:5173` (или другой порт, если 5173 занят).

JSON Server API работает на `http://localhost:3000`.

**Примечание**: Для локального запуска убедитесь, что порты 3000 и 5173 свободны.

#### Вариант 2: С Docker

1. Убедитесь, что Docker и Docker Compose установлены

2. Запустите все сервисы одной командой:
```bash
docker-compose up
```

Или в фоновом режиме:
```bash
docker-compose up -d
```

3. Приложение будет доступно по адресу `http://localhost:5173`

**Примечание**: При использовании Docker переменная `VITE_API_HOST` устанавливается во время сборки. Если нужно изменить адрес API, пересоберите образ:
```bash
docker-compose up --build
```

Для остановки:
```bash
docker-compose down
```

Для остановки и удаления образов:
```bash
docker-compose down --rmi all
```

### Переменные окружения

Для фронтенда можно настроить URL API через переменную окружения:

Создайте файл `frontend/.env`:
```env
VITE_API_HOST=http://localhost:3000
```

При использовании Docker переменные окружения настраиваются в `docker-compose.yml`.

### Сборка для продакшена

```bash
cd frontend
npm run build
```

Собранные файлы будут в папке `frontend/dist`.

Для предпросмотра продакшен сборки:
```bash
npm run preview
```

## Стек технологий

### Frontend

- **React 19** — UI библиотека с поддержкой серверных компонентов
- **TypeScript** — типизация для повышения надежности кода
- **Redux Toolkit** — управление глобальным состоянием приложения
- **RTK Query** — решение для работы с API (кеширование, инвалидация, ретраи)
- **React Router 7** — маршрутизация на клиенте
- **React Hook Form** — управление формами с валидацией
- **TailwindCSS 4** — utility-first CSS фреймворк для стилизации
- **HeroUI (NextUI)** — компонентная библиотека на основе TailwindCSS
- **Framer Motion** — анимации для улучшения UX
- **Vite** — быстрый сборщик для разработки и продакшена
- **Vitest** — современный фреймворк для тестирования
- **ESLint + Prettier** — линтинг и форматирование кода

### Backend

- **JSON Server** — REST API на основе JSON файла для быстрого прототипирования

### Архитектура

- **Feature-Sliced Design (FSD)** — методология организации кода по слоям и фичам
- **Steiger** — инструмент для проверки соблюдения правил FSD

## Архитектура

Проект организован по методологии **Feature-Sliced Design (FSD)**, которая обеспечивает масштабируемость и поддерживаемость кода.

### Структура проекта

```
src/
├── app/              # Инициализация приложения
│   ├── layout/       # Общие компоненты layout
│   ├── providers/    # Провайдеры (Redux, Router)
│   ├── routes/       # Конфигурация маршрутов
│   └── store/        # Redux store
│
├── pages/            # Страницы приложения
│   ├── tasks/        # Список задач
│   ├── task/         # Детальная страница задачи
│   └── taskCreate/   # Создание задачи
│
├── widgets/          # Композиционные блоки
│   ├── Tasks/        # Виджет списка задач
│   ├── TaskPage/     # Виджет страницы задачи
│   └── TaskCreate/   # Виджет создания задачи
│
├── features/         # Бизнес-логика по доменам
│   ├── tasks/        # Фича задач (API, UI компоненты)
│   └── theme/        # Фича переключения темы
│
└── shared/           # Переиспользуемый код
    ├── api/          # Базовый API клиент
    ├── lib/          # Утилиты, типы, константы
    └── ui/           # UI компоненты
```

### Принципы архитектуры

1. **Слои (layers)**:
   - `app` — инициализация приложения
   - `pages` — страницы-роуты
   - `widgets` — композиционные блоки
   - `features` — бизнес-логика
   - `shared` — общий код

2. **Правила импортов**: код может импортировать только из нижележащих слоев
   - `app` → все слои
   - `pages` → widgets, features, shared
   - `widgets` → features, shared
   - `features` → shared
   - `shared` → только shared

3. **Публичный API**: каждый модуль экспортирует только через `index.ts`

### Управление состоянием

Приложение использует **Redux Toolkit** с **RTK Query** для:

- Глобального состояния (тема приложения)
- Кеширования данных API
- Автоматической инвалидации кеша при мутациях
- Оптимистичных обновлений
- Ретраев при ошибках сети (до 2 попыток)

### Роутинг

Используется **React Router 7** с следующими маршрутами:

- `/` — список всех задач
- `/task/:id` — детальная страница задачи
- `/task/new` — создание новой задачи

Реализован автоматический скролл наверх при смене маршрута.

## Особенности реализации

### 1. Feature-Sliced Design

Выбрана методология FSD для:
- **Масштабируемости**: легко добавлять новые фичи без рефакторинга существующих
- **Изоляции**: фичи независимы друг от друга
- **Переиспользования**: shared слой содержит общие компоненты и утилиты
- **Проверки архитектуры**: Steiger автоматически проверяет соблюдение правил FSD

**Компромисс**: Некоторая избыточность кода на старте проекта, которая окупается при росте приложения.

### 2. RTK Query для работы с API

RTK Query предоставляет:
- Автоматическое кеширование данных
- Инвалидацию кеша при мутациях (create, update, delete)
- Типизацию запросов и ответов
- Встроенную обработку ошибок и loading состояний

**Особенность**: Использование тегов для точной инвалидации кеша:
- `Tasks` тег для списка задач
- `Task` тег для отдельной задачи

**Компромисс**: Дополнительная абстракция вместо прямых fetch запросов, но это упрощает управление состоянием.

### 3. Middleware для темы

Реализован кастомный middleware для синхронизации темы из Redux store с DOM:
- При изменении темы автоматически обновляются CSS классы на `<body>`
- Тема сохраняется в `localStorage` для сохранения предпочтений пользователя

**Проблема решена**: Необходимость синхронизации состояния Redux с DOM для применения темных стилей.

### 4. Пагинация на клиенте

JSON Server поддерживает пагинацию через query параметры `_page` и `_per_page`, что позволяет:
- Загружать данные порциями
- Отображать информацию о количестве страниц и навигации

**Ограничение**: JSON Server не поддерживает полноценную пагинацию с метаданными из коробки, поэтому используется адаптация ответа.

### 5. Валидация форм с React Hook Form

Использование React Hook Form обеспечивает:
- Минимальное количество ре-рендеров
- Простую валидацию через схемы
- Управление ошибками формы

### 6. Типизация TypeScript

Строгая типизация применена везде:
- Типы для всех API запросов и ответов
- Типы для компонентов и пропсов
- Типы для констант (category, status, priority) через const assertions

**Преимущество**: Ошибки выявляются на этапе разработки, а не в рантайме.

### 7. Тестирование

Проект использует **Vitest** и **React Testing Library** для:
- Unit-тестов утилит (formatDate, theme utils)
- Тестов компонентов (TaskItem, AppRouter)
- Тестов Redux слайсов (themeSlice)

**Улучшение**: Можно добавить интеграционные тесты и e2e тесты (Playwright/Cypress).

### 8. Обработка ошибок

Реализована централизованная обработка ошибок:
- Компонент `QueryError` для отображения ошибок RTK Query
- Компонент `ErrorMessage` для кастомных ошибок
- Retry механизм (2 попытки) для временных сбоев сети

### Возможные улучшения

1. **Аутентификация**: Добавить систему входа и регистрации
2. **Фильтрация**: Реализовать фильтры по статусу, категории и приоритету на сервере
3. **Поиск**: Добавить поиск задач по названию и описанию
4. **Сортировка**: Добавить сортировку задач по дате создания, приоритету
5. **Теги**: Добавить систему тегов для более гибкой категоризации
6. **Оптимистичные обновления**: Реализовать оптимистичные обновления UI до подтверждения сервера
7. **Офлайн режим**: Добавить Service Worker для работы без интернета
8. **WebSocket**: Добавить real-time обновления через WebSocket
9. **Backend**: Заменить JSON Server на полноценный backend (Node.js, Python, etc.)
10. **Интернационализация**: Добавить поддержку нескольких языков (i18n)

### Проблемы и решения

**Проблема**: JSON Server не возвращает метаданные пагинации в стандартном формате.

**Решение**: Использование заголовков ответа и адаптация структуры данных на клиенте.

**Проблема**: Необходимость синхронизации темы между Redux и DOM.

**Решение**: Middleware автоматически обновляет классы при изменении состояния темы.

**Проблема**: FSD требует строгого соблюдения правил импортов.

**Решение**: Использование Steiger для автоматической проверки нарушений в CI/CD или локально.

